name: Deploy Ansible AWS

on:
  push:
    branches:
    - master
    
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: checkout repo
      uses: actions/checkout@v2
    - name: go to path of files
      run: cd terraform_flask_run/ && pwd
    - name: create file
      env:
        SUPER_SECRET: ${{ secrets.FLASKTERRAFORM }}
      run: |
       cd terraform_flask_run/ && echo "$SUPER_SECRET" > flask-terraform.pem
    - name: list folder
      run: cd terraform_flask_run/ && cat flask-terraform.pem
    - name: deploy via ansible
      run: cd terraform_flask_run/ && ansible-playbook playbook.yml -u ubuntu --private-key flask-terraform.pem -i hosts.yml

